% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[english,11pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{letterpaper} % or letterpaper (US) or a5paper or....
\geometry{margin=0.75in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
%\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...
\usepackage{amsthm,amsmath, amssymb}
\usepackage[authoryear]{natbib}
\usepackage[colorlinks=true,citecolor=blue, urlcolor=blue,breaklinks]{hyperref}
\usepackage{babel}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx} % support the \includegraphics command and options
\usepackage{color}
\usepackage{framed}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

\usepackage{amssymb,amsmath,amsfonts}
\usepackage{hyperref}
\usepackage{natbib}

\usepackage{chngcntr}
\counterwithout{figure}{section}
\counterwithout{table}{section}
%%% SECTION TITLE APPEARANCE
%\usepackage{sectsty}
%\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
%\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
%\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
%\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
%\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

%%% END Article customizations

%%% The "real" document content comes below...

\title{\textsc{EigenEdge} package for MATLAB}
\author{Edgar Dobriban\thanks{Department of Statistics, Stanford University, \texttt{dobriban@stanford.edu}} }

%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle
\tableofcontents
\section{Introduction}

The \textsc{EigenEdge} MATLAB package contains open source implementations of methods for working with eigenvalue distributions of large random matrices. In particular, it contains the \textsc{Atomic} method to compute the limit empirical spectrum of sample covariance matrices \citep[proposed in][]{dobriban2015precise}. %These are methods for improving power in multiple testing via the use of prior information.  

\begin{itemize}
\item{Version: } 0.0.1
\item{Requirements: } Tested on MATLAB R2014b. 
\item{Author: } Edgar Dobriban
\item{License: } \verb+GPL-3+
\end{itemize}

In addition, this package contains the code to reproduce all simulation results from the paper \cite{dobriban2015precise}. These are contained in the \verb+\Experiments\Atomic+ folder.

\section{Installation}

Extract the archive in any folder, say to \verb+<path>+ . The main functions are in the \verb+Code+ directory, which needs to be on the Matlab path, along with all of its subfolders. This can be accomplished in at least three ways. First, you can add the following lines to your Matlab startup:

\begin{verbatim}
addpath('<path>/pvalue_weighting_matlab/Code')
addpath('<path>/pvalue_weighting_matlab/Code/Basic')
addpath('<path>/pvalue_weighting_matlab/Code/External Helper Code')
\end{verbatim}

The second option is to add those line to scripts that call functions in this package. The third option is to execute the  \verb+setpaths.m+ script every time you start a new session with the \textsc{EigenEdge} package. This will include the current folder in the Matlab search path.

An example computation is in the \verb+\Experiments\Examples\example.m+ file. This is described in Section \ref{example}.

This file is the main documentation for the package. To start, look at the example (Section \ref{example}) or at the methods implemented (Sections \ref{methods}).

\section{Example}
\label{example}

Here we give a simple example of using the \textsc{Atomic} function for computing limit spectra of sample covariance matrices. We refer to the paper \cite{dobriban2015precise} for a full description of the method. 

\subsection{Background}

We begin with the problem statement (borrowed from our paper). Consider a large $n \times p$ matrix $\mathbf{X}$, whose rows $x^i$ are independent random vectors. Suppose that $x^i$ are mean zero, and their covariance matrix is the $p \times p$ matrix $\Sigma = \mathbb{E}{x^i x^{i\top}}$. To estimate $\Sigma$, we form the sample covariance matrix

$$
\widehat{\Sigma} = \frac{1}{n} \mathbf{X}^\top \mathbf{X}.
$$

If $n$ and $p$ are of comparable size, then $\widehat{\Sigma}$ deviates substantially from the true covariance. The asymptotic theory of random matrices describes the behavior of the eigenvalues of $\widehat{\Sigma}$ as $n,p$ grow large proportionally \citep[e.g.][]{bai2009spectral}. It is well known that, if the distribution of the eigenvalues of $\Sigma$ tends to a limit population spectral distribution (SD) $H$, as $n,p \to \infty$ and the aspect ratio $p/n \to \gamma$, then the random eigenvalue distribution of $\widehat{\Sigma}$ also tends to a deterministic limit empirical spectrum $F$ \citep{marchenko1967distribution,silverstein1995strong}. This limit differs from the true spectrum.

\subsection{Quick example}

The \textsc{Atomic} method is designed to compute the limit sample spectrum $F$ from the limit population spectrum $H$. It is easy to use: in its simplest form, we need to provide a vector of population eigenvalues \verb+t+ (in this case $H$ is a uniform mixture of point masses at $t_i$), and an aspect ratio $\verb+gamma+$, and call $\verb+atomic(t,gamma)+$. \textsc{Atomic} will return a grid and pointwise density estimates of the limit spectrum $F$. 

The code below (excerpted from \verb+example.m+) shows an example, in which the eigenvalues are placed at \verb+t = [1; 5]+, and the aspect ratio \verb+gamma = 1/2+:


\begin{verbatim}
t = [1; 5]; %location of population eigenvalues: H = 1/n\sum delta_{t_i}
gamma = 1/2; %aspect ratio gamma = p/n
[grid, density] =  atomic(t, gamma); %compute limit spectrum
\end{verbatim}

The density can be plotted with 

\begin{verbatim}
figure, plot(grid, density,'r','LineWidth',4) %plot
xlabel('Eigenvalue')
ylabel('Density');
\end{verbatim}

The results are shown below:

\begin{figure}[ht!]
\centering
\includegraphics[scale=0.5]{"../Experiments/Examples/quick_example"}
\caption{Density of the limit spectrum}
\label{scatter_prior_current}
\end{figure}

\subsection{Longer example}


\section{Computational methods}
\label{methods}

\subsection{Atomic: computing the limit spectrum}

The \textsc{Atomic} method computes the limit sample spectrum of covariance matrices from the limit population spectrum. The  main user interface for this computation is \verb+atomic()+. This function takes as input the population spectral distribution $H$, aspect ratio $\gamma$, and other parameters, and computes the density of the limit spectrum on a grid. 

The basic syntax of this function is :

$$\verb+[grid, density]= atomic(t,gamma)+$$

In the basic setup, it requires only two inputs: 
\begin{itemize}
\item \verb+t+:  a vector of positive entries, the locations of the population eigenvalues (length $J$)
\item \verb+gamma+:  aspect ratio $\gamma = p/n$
\end{itemize}

In the basic case the population spectrum is defined as an equal mixture of point masses at $t_i$: $H = J^{-1} \sum_{i=1}^{J} \delta_{t_i}$. 

The outputs are: 
\begin{itemize}
\item \verb+grid+: a positive grid where the density is computed
\item \verb+density+: pointwise numerical approximations to the density on the \verb+grid+
\end{itemize}

The complete syntax of the function is:

$$\verb+[grid, density,m, v, mass_at_0, K_hat, l_hat, u_hat, x, f_hat]= atomic(t,gamma,varargin)+$$

Here, in addition to the above two arguments \verb+t,gamma+, a much larger set of input arguments can be specified within \verb+varargin+. A complete call, including all parameters, looks like:

$$\verb+atomic(t, gamma, w, r, w_int, epsilon,M)+$$

The extra arguments \verb+w, r, w_int, epsilon,M+ are optional. You can specify any subset of them, however, you must always use them in this order. If you wish to specify some later arguments, and leave some earlier ones default, then place an empty array \verb+[]+ in their place. For instance, to specify \verb+epsilon = 1e-6+ without specifying \verb+w+ etc, call  \verb+atomic(t,gamma,[],[],[],1e-6)+.
  
The inputs specify the population spectrum $H$ as a mixture of point masses and uniform distributions:

\begin{equation*}
\label{H_mixture}
H = \sum_{i=1}^{J} w_i \delta_{t_i} + \sum_{t=1}^{T} w^*_t U(a_t,b_t)  .
\end{equation*}

Here $\delta_t$ is the point mass at $t$ and $U(a,b)$ is the uniform distribution on $[a,b]$. The parameters of the mixture can be set using the parameters of \verb+atomic()+, which are, in order:

\begin{itemize}
\item \verb+w+: mixture weights of the components of $t$ in the input spectrum. This must be a positive vector of size J. The default is a uniform vector of length $J$: $w = (1,1,\ldots,1)/J$. If a continuous part of the component is also specified with \verb+r+, then this parameter must not be empty. The reason is that these weights and \verb+w_int+ implictly depend on each other, as they must sum to 1.

\item \verb+r+: intervals where the continuous part of the spectrum is supported.
       A real matrix of size $J \times 2$, the $t$-th row encodes the endpoints $[a_t,b_t]$ of the $i$-th continuous component of the spectrum, a uniform distribution on $[a_t,b_t]$.
\item \verb+w_int+:   weights of the continuous part of the spectrum. This must be a non-negative vector. The entry \verb+w_int[t]+ specifies the weights of the $i$-th continuous component of the spectrum, a uniform distribution on $[a_t,b_t]$. If this is empty, then the defualt value is a uniform distribution subject to the constraint \verb+sum(w)+sum(w\_int) =1+.
\item \verb+epsilon+: accuracy parameter. As the accuracy parameter $\varepsilon \to 0$, the density approximation becomes more accurate. However, only the convergence of the procedure is guaranteed, not the actual accuracy. 
\item \verb+M+:  number of grid points in each interval of the support. This is an additional parameter which allows the user to specify how many grid points should be used in each interval in the support of the sample spectrum. This is available for additonal flexibility. 
\item \verb+alg+: The algorithm used to compute the density. The available choices are \verb+ {'atomic','fp','Newton'};+. These stand for: \verb+ 'atomic'+ is the \textsc{Atomic} algorithm proposed in \cite{dobriban2015precise}, \verb+ 'fp'+ is the fixed point method described in \cite{couillet2011deterministic}, and \verb+ 'Newton'+ is Newton's method, which the author learned from Jack W. Silverstein, and which is described in \cite{dobriban2015precise}. Please see that paper for more information on each method. 
\end{itemize}

\subsection{Moments and Quantiles of the ESD}

\subsection{Utilities}

\subsubsection{Arithmetic and geometric models for eigenvalues}


\bibliography{eigenvalues}
\bibliographystyle{apalike}

\end{document}
